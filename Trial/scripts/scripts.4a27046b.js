"use strict";angular.module("clinicalTrialReportApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMaterial","angular.filter","ngWebAudio","chroma.angularChroma"]).config(["$routeProvider","$mdThemingProvider",function(a,b){b.theme("default").primaryPalette("light-blue").accentPalette("red"),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"})}]),angular.module("clinicalTrialReportApp").controller("MainCtrl",["$scope","WebAudio","$log","$http","$filter",function(a,b,c,d,e){var f=new AudioContext;a.play=!1,d.get("library.json").then(function(b){a.soundLibary=b.data}),a.stopSound=function(){f.close()},a.soundURLClicked=function(b){function c(){n=f.createScriptProcessor(2048,1,1),n.connect(f.destination),m=f.createAnalyser(),m.smoothingTimeConstant=0,m.fftSize=1024,l=f.createBufferSource(),l.connect(m),o.connect(m),m.connect(n),l.connect(f.destination)}function d(b){var c=new XMLHttpRequest;c.open("GET",b,!0),c.responseType="arraybuffer",c.onload=function(){f.decodeAudioData(c.response,function(b){g(b),a.play=!0},h)},c.send()}function g(a){l.buffer=a,l.start(0),console.log(l)}function h(a){console.log(a)}function i(a){var b=document.getElementById("canvas");r.drawImage(b,0,0,850,100);for(var c=0;c<a.length;c++){var d=a[c];p.fillStyle=s.getColor(d).hex(),p.fillRect(848,98-2*c,3,3)}p.translate(-2,0),p.drawImage(q,0,0,850,100,0,0,850,100),p.setTransform(1,0,0,1,0,0)}f.close();var j=e("getById")(a.soundLibary,b),k=j.url;a.found=j,window.AudioContext||(!window.webkitAudioContext,window.AudioContext=window.webkitAudioContext),f=new AudioContext;var l,m,n,o=f.createBiquadFilter();o.type=3,o.frequency.value=300,o.Q.value=81,o.gain.value=0;var p=angular.element("#canvas").get()[0].getContext("2d"),q=document.createElement("canvas"),r=q.getContext("2d");q.width=850,q.height=100;var s=new chroma.ColorScale({colors:["#000000","#ff0000","#ffff00","#C34742"],positions:[0,.1,.4,.6],mode:"rgb",limits:[0,350]});c(),d(k),n.onaudioprocess=function(){var a=new Uint8Array(m.frequencyBinCount);m.getByteFrequencyData(a),m.getFloatTimeDomainData(a),console.log(l),f.currentTime<20&&i(a)}},a.min=function(a){return e("min")(e("map")(a,"id"))}}]),angular.module("clinicalTrialReportApp").filter("getById",function(){return function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d].objectId===b)return a[d];return null}}),angular.module("clinicalTrialReportApp").run(["$templateCache",function(a){a.put("views/main.html",'<section layout="row" flex> <md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$mdMedia(\'gt-md\')"> <md-toolbar style="height:5vh"> <div md-toolbar-tools layout="row"> <div class="md-toolbar-tools"> <h1>Paitent List</h1> </div> </div> </md-toolbar> <md-input-container layout-padding style="height:10vh"> <label>Search for patient</label> <input type="text" ng-model="searchText" ngsearchtext="searchMe(searchText);"> </md-input-container> <md-content role="navigation" style="overflow-y: scroll; height:85vh"> <md-list role="list"> <md-menu ng-repeat="sounds in soundLibary | groupBy: \'patient\'" md-offset="200 0"> <md-list-item class="md-1-line" aria-label="Open demo menu" class="md-button" ng-click="$mdOpenMenu($event)"> Patient: {{sounds.$key}} - {{sounds.length}}sounds </md-list-item> <md-menu-content width="4"> <md-menu-item ng-repeat="s in sounds"> <md-button ng-click="soundURLClicked(\'{{s.objectId}}\')"> SoundID: {{s.objectId}} </md-button> </md-menu-item> </md-menu-content> </md-menu> </md-list> </md-content> </md-sidenav> <md- layout="row" flex layout-align="center start"> <md-card flex="75"> <md-toolbar md-scroll-shrink class="md-accent"> <div class="md-toolbar-tools"> <h1>Patient Number: {{found.patient}}</h1></div> </md-toolbar> <md-card-content flex="100"> <p>Heart Rate:</p> <p>Respiratory Rate:</p> <p>Average Stytolic:</p> <p>Average Diastolic:</p> <p>Murmur:</p> </md-card-content> <md-card-content flex="100" layout-align="center center"> <h3>Wave</h3> <canvas id="Wavecanvas" width="850" height="100" style="display: block; background-color: black; margin:0 auto"></canvas> <div layout="row" layout-align="center center"> </div> </md-card-content> <md-card-content flex="100" layout-align="center center"> <h3>Spectrogram</h3> <canvas id="canvas" width="850" height="100" style="display: block; background-color: black; margin:0 auto"></canvas> <div layout="row" layout-align="center center"> <md-button ng-click="stopSound()" class="md-accent">Stop</md-button> <md-button ng-click="play()" ng-disabled="!play">{{play}}</md-button> </div> </md-card-content> </md-card>  </md-></section>')}]);