"use strict";angular.module("clinicalTrialReportApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMaterial","angular.filter","ngWebAudio","chroma.angularChroma","picardy.fontawesome","pang"]).run(["pang",function(a){a.initialize("DRhAeaJerM56gyGw0Xd6COyMUUIb82NEL0wTWWR3","7SnNfFEamjlpEgSrJsdeXJ18hVeLs4A1y2b3TI78")}]).config(["$routeProvider","$mdThemingProvider",function(a,b){b.theme("default").primaryPalette("light-blue").accentPalette("red"),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/show/:aduioKey",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/signIn/:username/:key",{controller:"MainCtrl",templateUrl:"views/main.html"}).otherwise({redirectTo:"/"})}]),angular.module("clinicalTrialReportApp").controller("MainCtrl",["$scope","WebAudio","$log","$http","$filter","$location","$routeParams",function(a,b,c,d,e,f,g){a.play=!1;var h=0,i={username:"superUser",key:"whamwham99"};console.log(g);var j,k=Parse.Object.extend("comment");a.hideComment=!1,g.username===i.username&&g.key===i.key&&(a.hideComment=!0,console.log("asdjasd")),a.clearCmt=function(){a.cmt=""},a.sideMemuItemClicked=function(a){l(a),g.aduioKey=a};var l=function(c){a.foundData=!0,j=null,a.cmt="";var d=e("getById")(a.soundLibary,c),f=d.url,g=new Parse.Query(k);g.equalTo("soundID",c),g.first().then(function(b){b&&(a.cmtData=b,a.cmt=a.cmtData.attributes.cmt,a.$apply(),j=b)});var i,l,m,n,o=new chroma.ColorScale({colors:["#989898","#ff0000","#ffff00","#ffffff"],positions:[0,.25,.75,1],mode:"rgb",limits:[0,350]});a.found=d;var p=new b(f,{buffer:!0,loop:!1,gain:0});p.onPlay=function(){function b(a){console.log(a);var b=angular.element("#wave").get()[0].getContext("2d");b.fillStyle="#fff",b.clearRect(0,0,830,100);for(var c=830/a.length,d=0;d<a.length;d++){var e=a[d];b.fillRect(d*c,50-100*e,.2,.2),b.fillRect(d*c,50+100*e,.2,.2)}}function c(a){var b=angular.element("#spectrogram").get()[0].getContext("2d");h++;var c=document.createElement("canvas");c.width=830,c.height=100;var d=c.getContext("2d"),e=document.getElementById("spectrogram");d.drawImage(e,0,0,830,100);for(var f=0;f<a.length;f++){var g=a[f];b.fillStyle=o.getColor(g).hex(),b.fillRect(2*h,100-2*f,2,2)}b.drawImage(spectrogram,0,0,830,100,0,0,830,100),b.setTransform(1,0,0,1,0,0)}a.play=!1;var d=p.audioSrc.buffer.getChannelData(0);b(d),i=p.audioSrc.context,l=i.createAnalyser(),m=i.createScriptProcessor(2048,1,1),n=i.createBiquadFilter(),n.type=3,n.frequency.value=440,n.Q.value=0,n.gain.value=0,p.audioSrc.connect(n),n.connect(l),n.connect(i.destination),l.connect(m),m.connect(i.destination),m.onaudioprocess=function(){var a=new Uint8Array(l.frequencyBinCount);l.getByteFrequencyData(a),c(a);var b=new Uint8Array(l.frequencyBinCount);l.getByteTimeDomainData(b)}},p.onEnd=function(){console.log("stop drawing"),m.disconnect(i.destination),h=0,a.play=!0},p.onBuffered=function(){a.play=!0;var b=angular.element("#wave").get()[0].getContext("2d");b.clearRect(0,0,830,100),b=angular.element("#spectrogram").get()[0].getContext("2d"),b.clearRect(0,0,830,100)},a.startAudio=function(){p.play(),i&&m.connect(i.destination)},a.pause=function(){p.pause()},a.stopAudio=function(){p.stop()},a.saveCmt=function(){j?(j.set("cmt",a.cmt),j.save(null,{success:function(a){console.log(a)}})):(j=new k,j.set("cmt",a.cmt),j.set("soundID",a.found.objectId),j.save(null,{success:function(a){console.log(a)}}))}};a.min=function(a){return e("min")(e("map")(a,"id"))},d.get("combinedData.json").then(function(b){a.soundLibary=b.data,g.aduioKey&&a.sideMemuItemClicked(g.aduioKey)})}]),angular.module("clinicalTrialReportApp").filter("getById",function(){return function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d].objectId===b)return a[d];return null}}),angular.module("clinicalTrialReportApp").run(["$templateCache",function(a){a.put("views/main.html",'<section layout="row" flex style="overflow-y: scroll; height:100vh"> <md-sidenav style="height:100vh" class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$mdMedia(\'gt-md\')"> <md-toolbar style="height:5vh"> <div md-toolbar-tools layout="row"> <div class="md-toolbar-tools"> <h1>Paitent List</h1> </div> </div> </md-toolbar> <md-input-container layout-padding style="height:10vh"> <label>Search for patient</label> <input type="text" ng-model="search"> </md-input-container> <md-content role="navigation" style="overflow-y: scroll; height:95vh"> <md-list role="list"> <md-menu ng-repeat="sounds in soundLibary| filterBy: [\'patient\']: search | orderBy:\'patient\' | groupBy: \'patient\' " md-offset="200 0"> <md-list-item class="md-1-line" aria-label="Open demo menu" class="md-button" ng-click="$mdOpenMenu($event)"> <p ng-class="{hightlight: sounds[0].patient==found.patient}">Patient: {{sounds[0].patient}} - {{sounds.length}}sounds </p> </md-list-item> <md-menu-content width="4"> <md-menu-item ng-repeat="s in sounds" ng-class="{hightlight: s.objectId==found.objectId}"> <md-button ng-click="sideMemuItemClicked(\'{{s.objectId}}\')"> SoundID: {{s.objectId}} </md-button> </md-menu-item> </md-menu-content> </md-menu> </md-list> </md-content> </md-sidenav> <md-content layout="row" layout-margin flex layout-align="center start"> <md-card flex="75" layout-margin ng-hide="!foundData"> <md-toolbar md-scroll-shrink class="md-accent" layout="row"> <div class="md-toolbar-tools" flex> <h1>Patient Number: <b>{{found.patient}}</b></h1> </div> <div class="md-toolbar-tools" flex layout-align="end center"> <h2>SoundId: <b>{{found.objectId}}</b></h2> </div> </md-toolbar> <md-card-content layout-margin flex layout="row"> <md-content flex> <md-card> <md-card-content> <p class="redingTitle">Heart rate: <i class="unit"> bmp</i> </p> <h1 class="reading"> {{found.hr}} </h1> </md-card-content> </md-card> <md-card> <md-card-content> <p class="redingTitle">Respiratory Rate: <i class="unit">breath/minute</i> </p> <h1 class="reading"> {{found.rr}}</h1> </md-card-content> </md-card> </md-content> <md-content flex> <md-card flex> <md-card-content class="md-accent"> <p class="redingTitle">Average Stytole: <i class="unit">ms</i> </p> <h1 class="reading"> {{found.sys}}</h1> </md-card-content> </md-card> <md-card flex> <md-card-content class="md-accent"> <p class="redingTitle">Average Diastole: <i class="unit">ms</i> </p> <h1 class="reading"> {{found.dia}} </h1> </md-card-content> </md-card> </md-content> <md-content flex> <md-card flex> <md-card-content class="md-accent"> <p class="redingTitle" style="color:#E63567">Systolic Murmur: <i class="unit">...</i> </p> <h1 class="reading"> {{found.sm}}</h1> </md-card-content> </md-card> <md-card flex> <md-card-content class="md-accent"> <p class="redingTitle" style="color:#E63567">Diastolic Murmur: <i class="unit">...</i> </p> <h1 class="reading"> {{found.dm}} </h1> </md-card-content> </md-card> </md-content> </md-card-content> <md-card-content flex layout-align="center center" layout-fill style="background-color:#989898 ; margin:0"> <canvas id="wave" width="830" height="100" style="display: block; background-color:#989898; margin:0 auto"></canvas> <canvas id="spectrogram" width="830" height="100" style="display: block; background-color: #989898; margin:0 auto"></canvas> <div layout="row" layout-align="center center"> <md-button class="md-raised md-accent" ng-click="stopAudio()">Stop</md-button> <md-button class="md-raised" ng-click="startAudio()" ng-disabled="!play">Play</md-button> </div> </md-card-content> <md-card flex ng-show="hideComment"> <md-toolbar md-scroll-shrink class="md-accent" layout="row"> <div class="md-toolbar-tools" flex> <h2>Comment</h2> </div> </md-toolbar> <textarea class="myTxtArea" ng-model="cmt">\n                </textarea> <div class="md-actions" layout="row" layout-align="end center"> <md-button class="md-raised md-accent" ng-click="clearCmt()">Clear</md-button> <md-button class="md-raised" ng-click="saveCmt()">Save</md-button> </div> </md-card> <md-card flex ng-hide="hideComment"> <md-toolbar md-scroll-shrink class="md-accent" layout="row"> <div class="md-toolbar-tools" flex> <h2>Comment</h2> </div> </md-toolbar> <md-card-content> {{cmt}} </md-card-content> </md-card> </md-card> </md-content> </section> <style type="text/css">.myTxtArea {\n    border: none;\n    overflow: auto;\n    outline: none;\n    -webkit-box-shadow: none;\n    -moz-box-shadow: none;\n    box-shadow: none;\n    width: auto;\n    border: solid thin #CACAC4;\n    background-color: #F3F3F3;\n    resize: none;\n    margin: 2em;\n    height: 20vh;\n    min-height: 100px;\n    max-height: 300px;\n}</style>')}]);