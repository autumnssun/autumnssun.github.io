"use strict";angular.module("clinicalTrialReportApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMaterial","angular.filter","ngWebAudio","chroma.angularChroma","picardy.fontawesome"]).config(["$routeProvider","$mdThemingProvider",function(a,b){b.theme("default").primaryPalette("light-blue").accentPalette("red"),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"})}]),angular.module("clinicalTrialReportApp").controller("MainCtrl",["$scope","WebAudio","$log","$http","$filter",function(a,b,c,d,e){a.play=!1;var f=0;d.get("library.json").then(function(b){a.soundLibary=b.data}),a.sideMemuItemClicked=function(c){a.foundData=!0;var d,g,h,i,j=e("getById")(a.soundLibary,c),k=j.url,l=new chroma.ColorScale({colors:["#333333","#ff0000","#ffff00","#ffffff"],positions:[0,.25,.75,1],mode:"rgb",limits:[0,350]});a.found=j;var m=new b(k,{buffer:!0,loop:!1,gain:0});console.log(m),m.onPlay=function(){function a(a){console.log(a);var b=angular.element("#wave").get()[0].getContext("2d");b.fillStyle="#fff",b.clearRect(0,0,830,100);for(var c=830/a.length,d=0;d<a.length;d++){var e=a[d];b.fillRect(d*c,50-100*e,.2,.2),b.fillRect(d*c,50+100*e,.2,.2)}}function b(a){var b=angular.element("#spectrogram").get()[0].getContext("2d");f++;var c=document.createElement("canvas");c.width=830,c.height=100;var d=c.getContext("2d"),e=document.getElementById("spectrogram");d.drawImage(e,0,0,830,100);for(var g=0;g<a.length;g++){var h=a[g];b.fillStyle=l.getColor(h).hex(),b.fillRect(2*f,100-2*g,2,2)}b.drawImage(spectrogram,0,0,830,100,0,0,830,100),b.setTransform(1,0,0,1,0,0)}var c=m.audioSrc.buffer.getChannelData(0);a(c),d=m.audioSrc.context,g=d.createAnalyser(),h=d.createScriptProcessor(2048,1,1),i=d.createBiquadFilter(),i.type=3,i.frequency.value=440,i.Q.value=0,i.gain.value=0,m.audioSrc.connect(i),i.connect(g),i.connect(d.destination),g.connect(h),h.connect(d.destination),h.onaudioprocess=function(){var a=new Uint8Array(g.frequencyBinCount);g.getByteFrequencyData(a),b(a);var c=new Uint8Array(g.frequencyBinCount);g.getByteTimeDomainData(c)}},m.onEnd=function(){console.log("stop drawing"),h.disconnect(d.destination),f=0},m.onBuffered=function(){a.play=!0;var b=angular.element("#wave").get()[0].getContext("2d");b.clearRect(0,0,830,100),b=angular.element("#spectrogram").get()[0].getContext("2d"),b.clearRect(0,0,830,100)},a.startAudio=function(){m.play(),d&&h.connect(d.destination)},a.pause=function(){m.pause()},a.stopAudio=function(){m.stop();var a=angular.element("#wave").get()[0].getContext("2d");a.clearRect(0,0,830,100),a=angular.element("#spectrogram").get()[0].getContext("2d"),a.clearRect(0,0,830,100)}},a.min=function(a){return e("min")(e("map")(a,"id"))}}]),angular.module("clinicalTrialReportApp").filter("getById",function(){return function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d].objectId===b)return a[d];return null}}),angular.module("clinicalTrialReportApp").run(["$templateCache",function(a){a.put("views/main.html",'<section layout="row" flex> <md-sidenav style="height:100vh" class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$mdMedia(\'gt-md\')"> <md-toolbar style="height:5vh"> <div md-toolbar-tools layout="row"> <div class="md-toolbar-tools"> <h1>Paitent List</h1> </div> </div> </md-toolbar> <!-- <md-input-container layout-padding style=" height:10vh;">\n            <label>Search for patient</label>\n            <input type="text" ng-model="search" />\n        </md-input-container> --> <md-content role="navigation" style="overflow-y: scroll; height:95vh"> <md-list role="list"> <md-menu ng-repeat="sounds in soundLibary | groupBy: \'patient\' " md-offset="200 0"> <md-list-item class="md-1-line" aria-label="Open demo menu" class="md-button" ng-click="$mdOpenMenu($event)"> Patient: {{sounds[0].patient}} - {{sounds.length}}sounds </md-list-item> <md-menu-content width="4"> <md-menu-item ng-repeat="s in sounds"> <md-button ng-click="sideMemuItemClicked(\'{{s.objectId}}\')"> SoundID: {{s.objectId}} </md-button> </md-menu-item> </md-menu-content> </md-menu> </md-list> </md-content> </md-sidenav> <md- layout="row" flex layout-align="center start"> <md-card flex="75" ng-hide="!foundData"> <md-toolbar md-scroll-shrink class="md-accent" layout="row"> <div class="md-toolbar-tools" flex> <h1>Patient Number: <b>{{found.patient}}</b></h1> </div> <div class="md-toolbar-tools" flex layout-align="end center"> <h2>SoundId: <b>{{found.objectId}}</b></h2> </div> </md-toolbar> <md-card-content flex="100" layout="row"> <md-content flex> <p><fa class="fa fa-heart fa-4x"></fa> Heart Rate:</p> <p><fa class="fa fa-heart fa-4x"></fa>Respiratory Rate:</p> </md-content> <md-content flex> <p>Average Stytolic:</p> <p>Average Diastolic:</p> </md-content> <md-content flex> <p>Murmur:</p> </md-content> </md-card-content> <md-card-content flex="100" layout-align="center center"> <canvas id="wave" width="830" height="100" style="display: block; background-color:#333; margin:0 auto"></canvas> <canvas id="spectrogram" width="830" height="100" style="display: block; background-color: #333; margin:0 auto"></canvas> <div layout="row" layout-align="center center"> <md-button ng-click="stopAudio()" class="md-accent">Stop</md-button> <md-button ng-click="startAudio()" ng-disabled="!play">Play</md-button> </div> </md-card-content> </md-card>  </md-></section>')}]);